"use strict";var w=Math.pow;(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[879],{3879:(G,C,E)=>{E.r(C),E.d(C,{TGraphPainter:()=>P});var b=E(1773),A=E(2912),v=E(5611),B=E(2454),Y=E(9608),O=E(1671),S=E(9994),z=E(7222);const F=(0,b.BIT)(18);class P extends B.tK{constructor(t,e){super(t,e),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent="TGraphBentErrors"==e._typename,this.has_errors="TGraphErrors"==e._typename||"TGraphMultiErrors"==e._typename||"TGraphAsymmErrors"==e._typename||this.is_bent||e._typename.match(/^RooHist/)}redraw(){let t=Promise.resolve(!0);if(this.$redraw_hist){delete this.$redraw_hist;let e=this.getMainPainter();(null==e?void 0:e.$secondary)&&this.axes_draw&&(t=e.redraw())}return t.then(()=>this.drawGraph())}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){let t=this.getObject();return"TGraphMultiErrors"==(null==t?void 0:t._typename)?t:null}decodeOptions(t,e){var u;"string"==typeof t&&0==t.indexOf("same ")&&(t=t.slice(5));let s=this.getObject(),r=!!this.get_gme(),l=[],h=e?!!this.getMainPainter():!this.axes_draw;this.options||(this.options={});const g=(i,a)=>{Object.assign(a,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),r&&i.check("S=",!0)&&(a.ScaleErrX=i.partAsFloat()),i.check("L")&&(a.Line=1),i.check("F")&&(a.Fill=1),i.check("CC")&&(a.Curve=2),i.check("C")&&(a.Curve=1),i.check("*")&&(a.Mark=103),i.check("P0")&&(a.Mark=104),i.check("P")&&(a.Mark=1),i.check("B")&&(a.Bar=1,a.Errors=0),i.check("Z")&&(a.Errors=1,a.Ends=0),i.check("||")&&(a.Errors=1,a.MainError=0,a.Ends=1),i.check("[]")&&(a.Errors=1,a.MainError=0,a.Ends=2),i.check("|>")&&(a.Errors=1,a.Ends=3),i.check(">")&&(a.Errors=1,a.Ends=4),i.check("0")&&(a.Mark=1,a.Errors=1,a.OutRange=1),i.check("1")&&1==a.Bar&&(a.Bar=2),i.check("2")&&(a.Rect=1,a.Errors=0),i.check("3")&&(a.EF=1,a.Errors=0),i.check("4")&&(a.EF=2,a.Errors=0),i.check("5")&&(a.Rect=2,a.Errors=0),i.check("X")&&(a.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),r&&t&&(t.indexOf(";")>0?(l=t.split(";"),t=l.shift()):t.indexOf("_")>0&&(l=t.split("_"),t=l.shift()));let n=this.options,o=new v.pc(t);n.PadStats=o.check("USE_PAD_STATS");let m="";if(["USE_PAD_TITLE","LOGXY","LOGX","LOGY","LOGZ","GRIDXY","GRIDX","GRIDY","TICKXY","TICKX","TICKY"].forEach(i=>{o.check(i)&&(m+=";"+i)}),o.check("XAXIS_",!0)&&(m+=";XAXIS_"+o.part),o.check("YAXIS_",!0)&&(m+=";YAXIS_"+o.part),o.empty()&&(n.original=h?"lp":"alp",o=new v.pc(n.original)),o.check("NOOPT")&&(n.NoOpt=1),o.check("POS3D_",!0)&&(n.pos3d=o.partAsInt()-.5),n._pfc=o.check("PFC"),n._plc=o.check("PLC"),n._pmc=o.check("PMC"),o.check("A")&&(n.Axis=o.check("I")?"A":"AXIS"),o.check("X+")&&(n.Axis+="X+",n.second_x=h),o.check("Y+")&&(n.Axis+="Y+",n.second_y=h),o.check("RX")&&(n.Axis+="RX"),o.check("RY")&&(n.Axis+="RY"),r&&(n.blocks=[],n.skip_errors_x0=n.skip_errors_y0=!1,o.check("X0")&&(n.skip_errors_x0=!0),o.check("Y0")&&(n.skip_errors_y0=!0)),g(o,n),r&&o.check("S")&&(n.individual_styles=!0),void 0===n.Errors&&(n.Errors=!this.has_errors||r&&l.length?0:1),1==n.Mark&&1==s.fMarkerStyle&&(n.Mark=101),n.Line+n.Fill+n.Curve+n.Mark+n.Bar+n.EF+n.Rect+n.Errors==0&&o.empty()&&(n.Line=1),"TGraphErrors"==s._typename){let i=s.fEX.length,a=0;for(let x=0;x<i;++x)a=Math.max(a,s.fEX[x],s.fEY[x]);a<1e-100&&(n.Errors=0)}if(n.Axis)n.Axis.indexOf("A")<0&&(n.Axis="AXIS,"+n.Axis);else{let i=this.getPadPainter(),a=null==i?void 0:i.getRootPad(!0);(!a||(null==(u=null==a?void 0:a.fPrimitives)?void 0:u.arr[0])===s)&&(n.Axis="AXIS")}n.Axis+=m;for(let i=0;i<l.length;++i){let x={};g(new v.pc(l[i]),x),x.skip_errors_x0=n.skip_errors_x0,x.skip_errors_y0=n.skip_errors_y0,n.blocks.push(x)}}extractGmeErrors(t){if(!this.bins)return;let e=this.getObject();this.bins.forEach(s=>{s.eylow=e.fEyL[t][s.indx],s.eyhigh=e.fEyH[t][s.indx]})}createBins(){let t=this.getObject();if(!t)return;let e=0,s=t.fNpoints;"TCutG"===t._typename&&s>3&&s--,"TGraphErrors"==t._typename?e=1:"TGraphMultiErrors"==t._typename?e=2:("TGraphAsymmErrors"==t._typename||"TGraphBentErrors"==t._typename||t._typename.match(/^RooHist/))&&(e=3),this.bins=new Array(s);for(let r=0;r<s;++r){let l=this.bins[r]={x:t.fX[r],y:t.fY[r],indx:r};switch(e){case 1:l.exlow=l.exhigh=t.fEX[r],l.eylow=l.eyhigh=t.fEY[r];break;case 2:l.exlow=t.fExL[r],l.exhigh=t.fExH[r],l.eylow=t.fEyL[0][r],l.eyhigh=t.fEyH[0][r];break;case 3:l.exlow=t.fEXlow[r],l.exhigh=t.fEXhigh[r],l.eylow=t.fEYlow[r],l.eyhigh=t.fEYhigh[r]}0===r&&(this.xmin=this.xmax=l.x,this.ymin=this.ymax=l.y),e>0?(this.xmin=Math.min(this.xmin,l.x-l.exlow,l.x+l.exhigh),this.xmax=Math.max(this.xmax,l.x-l.exlow,l.x+l.exhigh),this.ymin=Math.min(this.ymin,l.y-l.eylow,l.y+l.eyhigh),this.ymax=Math.max(this.ymax,l.y-l.eylow,l.y+l.eyhigh)):(this.xmin=Math.min(this.xmin,l.x),this.xmax=Math.max(this.xmax,l.x),this.ymin=Math.min(this.ymin,l.y),this.ymax=Math.max(this.ymax,l.y))}}createHistogram(t,e,s){let r=this.xmin,l=this.xmax,h=this.ymin,g=this.ymax;r>=l&&(l=r+1),h>=g&&(g=h+1);let n=.1*(l-r),o=.1*(g-h),m=r-n,f=l+n,u=h-o,i=g+o;m<0&&r>=0&&(m=.9*r),f>0&&l<=0&&(f=0);let a=this.getObject();if(-1111!=a.fMinimum&&(u=h=a.fMinimum),-1111!=a.fMaximum&&(i=a.fMaximum),u<0&&h>=0&&(u=.9*h),!e&&!s&&(e=s=!0),!(t=a.fHistogram)){(t=a.fHistogram=(0,b.createHistogram)("TH1F",100)).fName=a.fName+"_h";let x=(0,b.BIT)(9);t.fBits=t.fBits|x,this._own_histogram=!0}return t.fTitle=a.fTitle,e&&(t.fXaxis.fXmin=m,t.fXaxis.fXmax=f),s&&(t.fYaxis.fXmin=u,t.fYaxis.fXmax=i,t.fMinimum=u,t.fMaximum=i),t}unzoomUserRange(t,e){var l;let s=this.getObject();if(this._own_histogram||!s)return!1;let r=s.fHistogram;return e=e&&r&&(r.fYaxis.fXmin>this.ymin||r.fYaxis.fXmax<this.ymax),!(!(t=t&&r&&(r.fXaxis.fXmin>this.xmin||r.fXaxis.fXmax<this.xmax))&&!e||(this.createHistogram(null,t,e),null==(l=this.getMainPainter())||l.extractAxesProperties(1),0))}canOptimize(){return b.settings.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,e){if(this.bins.length<30&&!e)return this.bins;let s=null;if("function"==typeof e)for(let h=0;h<this.bins.length;++h)e(this.bins[h],h)?s||(s=0==h?[]:this.bins.slice(0,h)):s&&s.push(this.bins[h]);if(s||(s=this.bins),t||(t=5e5),s.length<t||!this.canOptimize())return s;let r=Math.floor(s.length/t);r<2&&(r=2);let l=[];for(let h=0;h<s.length;h+=r)l.push(s[h]);return l}getTooltips(t){let e=this.getFramePainter(),s=[],r=null==e?void 0:e.getGrFuncs(this.options.second_x,this.options.second_y),l=this.get_gme();if(s.push(this.getObjectHint()),t&&r)if(void 0!==t.indx&&s.push("p = "+t.indx),s.push("x = "+r.axisAsText("x",t.x)),s.push("y = "+r.axisAsText("y",t.y)),l?s.push("error x = -"+r.axisAsText("x",l.fExL[t.indx])+"/+"+r.axisAsText("x",l.fExH[t.indx])):this.options.Errors&&"normal"==r.x_handle.kind&&(t.exlow||t.exhigh)&&s.push("error x = -"+r.axisAsText("x",t.exlow)+"/+"+r.axisAsText("x",t.exhigh)),l)for(let h=0;h<l.fNYErrors;++h)s.push(`error y${h} = -${r.axisAsText("y",l.fEyL[h][t.indx])}/+${r.axisAsText("y",l.fEyH[h][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&"normal"==r.y_handle.kind&&(t.eylow||t.eyhigh)&&s.push("error y = -"+r.axisAsText("y",t.eylow)+"/+"+r.axisAsText("y",t.eyhigh));return s}get_main(){let t=this.getFramePainter();if(t&&t.grx&&t.gry)return t;let e=this.getPadPainter(),s=(null==e?void 0:e.getPadRect())||{width:800,height:600};return t={pad_layer:!0,pad:null==e?void 0:e.getRootPad(!0),pw:s.width,ph:s.height,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(r){return(r=this.pad.fLogx?r>0?Math.log10(r):this.pad.fUxmin:(r-this.pad.fX1)/(this.pad.fX2-this.pad.fX1))*this.pw},gry(r){return(1-(r=this.pad.fLogy?r>0?Math.log10(r):this.pad.fUymin:(r-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)))*this.ph},getGrFuncs(){return this}},t.pad?t:null}appendExclusion(t,e,s,r){let l=[];for(let g=s.length-1;g>=0;--g){let n=s[g],o=Math.sqrt(w(n.dgrx,2)+w(n.dgry,2));n.grx+=r*n.dgry/o,n.gry-=r*n.dgrx/o,l.push(n)}let h=(0,v.Cq)(t?"Lbezier":"Lline",l);this.draw_g.append("svg:path").attr("d",e.path+h.path+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,e,s,r,l,h,g,n){let o=this.getObject(),m=0,f=null;if(n&&h.excl_side&&(m=h.excl_width,h.width>0&&!e.Line&&!e.Curve&&(e.Line=1)),e.EF){f=this.optimizeBins(e.EF>1?2e4:0);for(let c=0;c<f.length;++c){let d=f[c];d.grx=t.grx(d.x),d.gry=t.gry(d.y-d.eylow)}let i=(0,v.Cq)(e.EF>1?"bezier":"line",f),a=[];for(let c=f.length-1;c>=0;--c){let d=f[c];d.gry=t.gry(d.y+d.eyhigh),a.push(d)}let x=(0,v.Cq)(e.EF>1?"Lbezier":"Lline",a);s.append("svg:path").attr("d",i.path+x.path+"Z").call(g.func),n&&(this.draw_kind="lines")}if(e.Line||e.Fill){let i="";"TCutG"==o._typename&&(e.Fill=1),e.Fill&&(i="Z",m=0),f||(f=this.optimizeBins(0));for(let d=0;d<f.length;++d){let _=f[d];_.grx=t.grx(_.x),_.gry=t.gry(_.y)}let a="line";m&&(a+="calc");let x=(0,v.Cq)(a,f);m&&this.appendExclusion(!1,x,f,m);let c=s.append("svg:path").attr("d",x.path+i);e.Line&&c.call(h.func),e.Fill?c.call(g.func):c.style("fill","none"),n&&(this.draw_kind="lines")}if(e.Curve){let i=f;if("lines"!=this.draw_kind||!i||1==e.Curve&&i.length>2e4){i=this.optimizeBins(1==e.Curve?2e4:0);for(let c=0;c<i.length;++c){let d=i[c];d.grx=t.grx(d.x),d.gry=t.gry(d.y)}}let a="bezier";m&&(a+="calc");let x=(0,v.Cq)(a,i);m&&this.appendExclusion(!0,x,i,m),s.append("svg:path").attr("d",x.path).call(h.func).style("fill","none"),n&&(this.draw_kind="lines")}let u=null;if((e.Errors||e.Rect||e.Bar)&&(f=this.optimizeBins(5e3,(i,a)=>{let x=t.grx(i.x);if(!e.Bar&&(x<0||x>r))return!0;let c=t.gry(i.y);return!e.Bar&&!e.OutRange&&(c<0||c>l)||(i.grx1=Math.round(x),i.gry1=Math.round(c),this.has_errors&&(i.grx0=Math.round(t.grx(i.x-e.ScaleErrX*i.exlow)-x),i.grx2=Math.round(t.grx(i.x+e.ScaleErrX*i.exhigh)-x),i.gry0=Math.round(t.gry(i.y-i.eylow)-c),i.gry2=Math.round(t.gry(i.y+i.eyhigh)-c),this.is_bent?(i.grdx0=Math.round(t.gry(i.y+o.fEXlowd[a])-c),i.grdx2=Math.round(t.gry(i.y+o.fEXhighd[a])-c),i.grdy0=Math.round(t.grx(i.x+o.fEYlowd[a])-x),i.grdy2=Math.round(t.grx(i.x+o.fEYhighd[a])-x)):i.grdx0=i.grdx2=i.grdy0=i.grdy2=0),!1)}),n&&(this.draw_kind="nodes"),u=s.selectAll(".grpoint").data(f).enter().append("svg:g").attr("class","grpoint").attr("transform",i=>`translate(${i.grx1},${i.gry1})`)),e.Bar){for(let x=1;x<f.length-1;++x)f[x].width=Math.max(2,(f[x+1].grx1-f[x-1].grx1)/2-2);switch(f.length){case 0:break;case 1:f[0].width=r/4;break;case 2:f[0].width=f[1].width=(f[1].grx1-f[0].grx1)/2;break;default:f[0].width=f[1].width,f[f.length-1].width=f[f.length-2].width}let i=Math.round(t.gry(0)),a=g;if(n){let x=this.getFramePainter(),c=(null==x?void 0:x.fillatt)&&!(null==x?void 0:x.fillatt.empty())?x.fillatt.getFillColor():-1;c===g.getFillColor()&&(a=new S.Y({color:"white"==c?1:0,pattern:1001}))}u.append("svg:path").attr("d",x=>{x.bar=!0;let c=Math.round(-x.width/2),d=Math.round(x.width);return`M${c},${1!==e.Bar?0:x.gry1>i?i-x.gry1:0}h${d}v${1!==e.Bar?l>x.gry1?l-x.gry1:0:Math.abs(i-x.gry1)}h${-d}z`}).call(a.func)}if(e.Rect&&u.filter(i=>i.exlow>0&&i.exhigh>0&&i.eylow>0&&i.eyhigh>0).append("svg:path").attr("d",i=>(i.rect=!0,`M${i.grx0},${i.gry0}H${i.grx2}V${i.gry2}H${i.grx0}Z`)).call(g.func).call(2===e.Rect?h.func:()=>{}),this.error_size=0,e.Errors){let i=h.width+b.gStyle.fEndErrorSize,a=0,x=e.Ends?`m0,${i}v${-2*i}`:"",c=e.Ends?`m${i},0h${-2*i}`:"",d=x,_=x,p=c,M=c;const $=(y,T)=>{if(!e.MainError)return`M${y},${T}`;let X="M0,0";return y?X+(T?`L${y},${T}`:`H${y}`):T?`M0,0V${T}`:X};switch(e.Ends){case 2:a=Math.max(h.width+1,Math.round(.66*i)),d=`m${a},${i}h${-a}v${-2*i}h${a}`,_=`m${-a},${i}h${a}v${-2*i}h${-a}`,p=`m${-i},${a}v${-a}h${2*i}v${a}`,M=`m${-i},${-a}v${a}h${2*i}v${-a}`;break;case 3:i=Math.max(i,Math.round(8*o.fMarkerSize*.66)),a=Math.max(h.width+1,Math.round(.66*i)),d=`l${a},${i}v${-2*i}l${-a},${i}`,_=`l${-a},${i}v${-2*i}l${a},${i}`,p=`l${-i},${a}h${2*i}l${-i},${-a}`,M=`l${-i},${-a}h${2*i}l${-i},${a}`;break;case 4:i=Math.max(i,Math.round(8*o.fMarkerSize*.66)),a=Math.max(h.width+1,Math.round(.66*i)),d=`l${a},${i}m0,${-2*i}l${-a},${i}`,_=`l${-a},${i}m0,${-2*i}l${a},${i}`,p=`l${-i},${a}m${2*i},0l${-i},${-a}`,M=`l${-i},${-a}m${2*i},0l${-i},${a}`}this.error_size=i,i=Math.floor((h.width-1)/2);let k=u.filter(y=>y.exlow>0||y.exhigh>0||y.eylow>0||y.eyhigh>0);(e.skip_errors_x0||e.skip_errors_y0)&&(k=k.filter(y=>!(0==y.x&&e.skip_errors_x0||0==y.y&&e.skip_errors_y0))),!(0,b.isBatchMode)()&&b.settings.Tooltip&&n&&k.append("svg:path").style("fill","none").style("pointer-events","visibleFill").attr("d",y=>`M${y.grx0},${y.gry0}h${y.grx2-y.grx0}v${y.gry2-y.gry0}h${y.grx0-y.grx2}z`),k.append("svg:path").call(h.func).style("fill","none").attr("d",y=>(y.error=!0,(y.exlow>0?$(y.grx0+i,y.grdx0)+d:"")+(y.exhigh>0?$(y.grx2-i,y.grdx2)+_:"")+(y.eylow>0?$(y.grdy0,y.gry0-i)+M:"")+(y.eyhigh>0?$(y.grdy2,y.gry2+i)+p:"")))}if(e.Mark){this.createAttMarker({attr:o,style:e.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();let a,x,c,i="",d=!(0,b.isBatchMode)()&&b.settings.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!u&&n,_="",p=Math.max(5,Math.round(.7*this.marker_size)),M=1e6/(this.markeratt.getMarkerLength()+7),$=1;f?this.canOptimize()&&f.length>1.5*M&&($=Math.min(2,Math.round(f.length/M))):f=this.optimizeBins(M);for(let k=0;k<f.length;k+=$)a=f[k],x=t.grx(a.x),x>-this.marker_size&&x<r+this.marker_size&&(c=t.gry(a.y),c>-this.marker_size&&c<l+this.marker_size&&(i+=this.markeratt.create(x,c),d&&(_+=`M${x-p},${c-p}h${2*p}v${2*p}h${-2*p}z`)));i.length>0&&(s.append("svg:path").attr("d",i).call(this.markeratt.func),null===u&&"none"==this.draw_kind&&n&&(this.draw_kind=101==e.Mark?"path":"mark")),d&&_&&s.append("svg:path").attr("d",_).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,e){let s=Math.max(t.scale_xmin,e.fXq1),r=Math.min(t.scale_xmax,e.fXq2),l=Math.max(t.scale_ymin,e.fYq1),h=Math.min(t.scale_ymax,e.fYq2),g="",n=(i,a,x,c)=>`M${t.grx(i)},${t.gry(a)}L${t.grx(x)},${t.gry(c)}`,o=(e.fYq2-e.fYq1)*(t.scale_xmin-e.fXq1)/(e.fXq2-e.fXq1)+e.fYq1,m=(e.fYq2-e.fYq1)*(t.scale_xmax-e.fXq1)/(e.fXq2-e.fXq1)+e.fYq1;g=o<t.scale_ymin?n((e.fXq2-e.fXq1)*(t.scale_ymin-e.fYq1)/(e.fYq2-e.fYq1)+e.fXq1,t.scale_ymin,s,l):n(t.scale_xmin,o,s,l),g+=m>t.scale_ymax?n(r,h,(e.fXq2-e.fXq1)*(t.scale_ymax-e.fYq1)/(e.fYq2-e.fYq1)+e.fXq1,t.scale_ymax):n(r,h,t.scale_xmax,m);let f=new O.rE({style:1,width:1,color:"black"}),u=new O.rE({style:2,width:1,color:"black"});this.draw_g.append("path").attr("d",n(s,l,r,h)).call(f.func).style("fill","none"),this.draw_g.append("path").attr("d",g).call(u.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}drawGraph(){let t=this.get_main(),e=this.getObject();if(!t)return;if(this.options.pos3d)return this.drawBins3D(t,e);let s=!!this.get_gme(),r=t.getGrFuncs(this.options.second_x,this.options.second_y),l=t.getFrameWidth(),h=t.getFrameHeight();if(this.createG(!t.pad_layer),this.options._pfc||this.options._plc||this.options._pmc){let n=this.getMainPainter();if("function"==typeof(null==n?void 0:n.createAutoColor)){let o=n.createAutoColor();this.options._pfc&&(e.fFillColor=o,delete this.fillatt),this.options._plc&&(e.fLineColor=o,delete this.lineatt),this.options._pmc&&(e.fMarkerColor=o,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1}}this.createAttLine({attr:e,can_excl:!0}),this.createAttFill({attr:e}),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;let g=s?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(r,this.options,g,l,h,this.lineatt,this.fillatt,!0),"TGraphQQ"==e._typename&&this.appendQQ(r,e),s){for(let n=0;n<e.fNYErrors;++n){let o=this.lineatt,m=this.fillatt;this.options.individual_styles&&(o=new O.rE({attr:e.fAttLine[n],std:!1}),m=new S.Y({attr:e.fAttFill[n],std:!1,svg:this.getCanvSvg()}));let f=this.draw_g.append("svg:g"),u=n<this.options.blocks.length?this.options.blocks[n]:this.options;this.extractGmeErrors(n),this.drawBins(r,u,f,l,h,o,m)}this.extractGmeErrors(0)}(0,b.isBatchMode)()||(0,z.Z)(this,this.testEditable())}extractTooltip(t){if(!t)return null;if("lines"==this.draw_kind||"path"==this.draw_kind||"mark"==this.draw_kind)return this.extractTooltipForPath(t);if("nodes"!=this.draw_kind)return null;let e=this.getFramePainter(),s=e.getFrameHeight(),r=this.error_size,l=1===this.options.Bar,h=l?e.getGrFuncs(this.options.second_x,this.options.second_y):null,g=null,n=1e10,o=null,m=this.marker_size?Math.round(this.marker_size/2+1.5):0;if(this.draw_g.selectAll(".grpoint").each(function(){let a=(0,A.Ys)(this).datum();if(void 0===a)return;let c,x=w(t.x-a.grx1,2);if(1===t.nproc&&(x+=w(t.y-a.gry1,2)),x>=n)return;if(a.error||a.rect||a.marker)c={x1:Math.min(-r,a.grx0,-m),x2:Math.max(r,a.grx2,m),y1:Math.min(-r,a.gry2,-m),y2:Math.max(r,a.gry0,m)};else if(a.bar){if(c={x1:-a.width/2,x2:a.width/2,y1:0,y2:s-a.gry1},l){let p=h.gry(0);c.y1=a.gry1>p?p-a.gry1:0,c.y2=a.gry1>p?0:p-a.gry1}}else c={x1:-5,x2:5,y1:-5,y2:5};let _=t.y>=a.gry1+c.y1&&t.y<=a.gry1+c.y2;t.x>=a.grx1+c.x1&&t.x<=a.grx1+c.x2&&(_||t.nproc>1)&&(n=x,g=this,o=c,o.exact=_)}),null===g)return null;let f=(0,A.Ys)(g).datum(),u=this.getObject(),i={name:u.fName,title:u.fTitle,x:f.grx1,y:f.gry1,color1:this.lineatt.color,lines:this.getTooltips(f),rect:o,d3bin:g};return i.user_info={obj:u,name:u.fName,bin:f.indx,cont:f.y,grx:f.grx1,gry:f.gry1},this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(i.color2=this.fillatt.getFillColor()),o.exact&&(i.exact=!0),i.menu=i.exact,i.menu_dist=3,i.bin=f,i.binindx=f.indx,i}showTooltip(t){if(!t)return void(this.draw_g&&this.draw_g.select(".tooltip_bin").remove());if(t.usepath)return this.showTooltipForPath(t);let e=(0,A.Ys)(t.d3bin).datum(),s=this.draw_g.select(".tooltip_bin");s.empty()&&(s=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),t.changed=s.property("current_bin")!==t.d3bin,t.changed&&s.attr("x",e.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",e.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){let e=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(e),e}findBestBin(t){if(!this.bins)return null;let n,o,m,f,u,e="lines"==this.draw_kind,s=-1,r=null,l=1e10,g=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y);for(f=0;f<this.bins.length;++f)u=this.bins[f],o=g.grx(u.x),m=g.gry(u.y),n=w(t.x-o,2)+w(t.y-m,2),n<l&&(l=n,r=u,s=f);l>100&&e&&(r=null);let i=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(i=Math.max(this.marker_size,i)),r&&(l=Math.sqrt(w(t.x-g.grx(r.x),2)+w(t.y-g.gry(r.y),2))),!e&&l>i&&(r=null),r||(s=-1);let a={bin:r,indx:s,dist:l,radius:Math.round(i)};if(!r&&e){l=1e10;const x=(M,$,k)=>$>=M&&M>=k||$<=M&&M<=k;let _,c=this.bins[0],d=g.grx(c.x),p=0;for(f=1;f<this.bins.length;++f)u=this.bins[f],o=g.grx(u.x),x(t.x,d,o)&&(_=g.gry(c.y),m=g.gry(u.y),Math.abs(o-d)<1?(p=t.y,n=x(t.y,_,m)?0:Math.min(Math.abs(t.y-_),Math.abs(t.y-m))):(p=_+(t.x-d)/(o-d)*(m-_),n=Math.abs(p-t.y)),n<l&&(l=n,a.linex=t.x,a.liney=p)),c=u,d=o;l<.5*i&&(a.linedist=l,a.closeline=!0)}return a}testEditable(t){let e=this.getObject();return!!e&&(("toggle"==t||void 0!==t&&!t!=e.TestBit(F))&&e.InvertBit(F),!e.TestBit(F))}extractTooltipForPath(t){if(null===this.bins)return null;let e=this.findBestBin(t);if(!e||!e.bin&&!e.closeline)return null;let s="lines"==this.draw_kind,r="mark"==this.draw_kind,h=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),g=this.getObject(),n={name:g.fName,title:g.fTitle,x:e.bin?h.grx(e.bin.x):e.linex,y:e.bin?h.gry(e.bin.y):e.liney,color1:this.lineatt.color,lines:this.getTooltips(e.bin),usepath:!0};return n.user_info={obj:g,name:g.fName,bin:0,cont:0,grx:n.x,gry:n.y},n.ismark=r,n.islines=s,e.closeline?(n.menu=n.exact=!0,n.menu_dist=e.linedist):e.bin&&(this.options.EF&&s?(n.gry1=h.gry(e.bin.y-e.bin.eylow),n.gry2=h.gry(e.bin.y+e.bin.eyhigh)):n.gry1=n.gry2=h.gry(e.bin.y),n.binindx=e.indx,n.bin=e.bin,n.radius=e.radius,n.user_info.bin=e.indx,n.user_info.cont=e.bin.y,n.exact=Math.abs(t.x-n.x)<=e.radius&&(Math.abs(t.y-n.gry1)<=e.radius||Math.abs(t.y-n.gry2)<=e.radius),n.menu=n.exact,n.menu_dist=Math.sqrt(w(t.x-n.x,2)+w(Math.min(Math.abs(t.y-n.gry1),Math.abs(t.y-n.gry2)),2))),this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(n.color2=this.fillatt.getFillColor()),s||(n.color1=this.getColor(g.fMarkerColor),n.color2||(n.color2=n.color1)),n}showTooltipForPath(t){let e=this.draw_g.select(".tooltip_bin");if(t&&t.bin){if(e.empty()&&(e=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=e.property("current_bin")!==t.bin,t.changed)if(e.selectAll("*").remove(),e.property("current_bin",t.bin),t.ismark)e.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{e.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&e.append("svg:circle").attr("cy",Math.round(t.gry2));let s=e.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?s.call(this.lineatt.func):s.style("stroke","black"),this.options.Fill?s.call(this.fillatt.func):s.style("fill","none")):s.style("stroke","black"==t.color1?"green":"black").style("fill","none")}}else e.remove()}moveEnabled(){return this.testEditable()}moveStart(t,e){this.pos_dx=this.pos_dy=0;let s=this.extractTooltip({x:t,y:e});if(s&&s.exact&&void 0!==s.binindx){this.move_binindx=s.binindx,this.move_bin=s.bin;let r=this.getFramePainter(),l=null==r?void 0:r.getGrFuncs(this.options.second_x,this.options.second_y);this.move_x0=l?l.grx(this.move_bin.x):t,this.move_y0=l?l.gry(this.move_bin.y):e}else delete this.move_binindx}moveDrag(t,e){if(this.pos_dx+=t,this.pos_dy+=e,void 0===this.move_binindx)this.draw_g.attr("transform",`translate(${this.pos_dx},${this.pos_dy})`);else{let s=this.getFramePainter(),r=null==s?void 0:s.getGrFuncs(this.options.second_x,this.options.second_y);r&&this.move_bin&&(this.move_bin.x=r.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=r.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}}moveEnd(t){let e="";if(void 0===this.move_binindx){this.draw_g.attr("transform",null);let s=this.getFramePainter(),r=null==s?void 0:s.getGrFuncs(this.options.second_x,this.options.second_y);if(r&&this.bins&&!t){for(let l=0;l<this.bins.length;++l){let h=this.bins[l];h.x=r.revertAxis("x",r.grx(h.x)+this.pos_dx),h.y=r.revertAxis("y",r.gry(h.y)+this.pos_dy),e+=`SetPoint(${h.indx},${h.x},${h.y});;`,0==h.indx&&this.matchObjectType("TCutG")&&(e+=`SetPoint(${this.getObject().fNpoints-1},${h.x},${h.y});;`)}this.drawGraph()}}else e=`SetPoint(${this.move_bin.indx},${this.move_bin.x},${this.move_bin.y});;`,0==this.move_bin.indx&&this.matchObjectType("TCutG")&&(e+=`SetPoint(${this.getObject().fNpoints-1},${this.move_bin.x},${this.move_bin.y});;`),delete this.move_binindx;e&&!t&&this.submitCanvExec(e)}fillContextMenu(t){return super.fillContextMenu(t),this.snapid||t.addchk(this.testEditable(),"Editable",()=>{this.testEditable("toggle"),this.drawGraph()}),t.size()>0}executeMenuCommand(t,e){var l,h;if(super.executeMenuCommand(t,e))return!0;let s=this.getCanvPainter(),r=this.getFramePainter();if("RemovePoint"==t.fName||"InsertPoint"==t.fName){let g=null==r?void 0:r.getLastEventPos();if(!s||s._readonly||!g)return!0;let n=this.extractTooltip(g);if("InsertPoint"==t.fName){let o=null==r?void 0:r.getGrFuncs(this.options.second_x,this.options.second_y),m=null!=(l=null==o?void 0:o.revertAxis("x",g.x))?l:0,f=null!=(h=null==o?void 0:o.revertAxis("y",g.y))?h:0;this.submitCanvExec(`AddPoint(${m.toFixed(3)}, ${f.toFixed(3)})`,this.args_menu_id)}else this.args_menu_id&&void 0!==(null==n?void 0:n.binindx)&&this.submitCanvExec(`RemovePoint(${n.binindx})`,this.args_menu_id);return!0}return!1}updateObject(t,e){if(!this.matchObjectType(t))return!1;e&&e!=this.options.original&&this.decodeOptions(e);let s=this.getObject();if(s.fBits=t.fBits,s.fTitle=t.fTitle,s.fX=t.fX,s.fY=t.fY,s.fNpoints=t.fNpoints,s.fMinimum=t.fMinimum,s.fMaximum=t.fMaximum,this.createBins(),delete this.$redraw_hist,this.axes_draw){let r=this.createHistogram(t.fHistogram);r.fTitle=s.fTitle;let l=this.getMainPainter();(null==l?void 0:l.$secondary)&&(l.updateObject(r,this.options.Axis),this.$redraw_hist=!0)}return!0}canZoomInside(t,e,s){let r=this.getObject();if(!r||t!==(this.options.pos3d?"y":"x"))return!1;for(let l=0;l<r.fNpoints;++l)if(e<r.fX[l]&&r.fX[l]<s)return!0;return!1}clickButton(t){if("ToggleZoom"!==t)return!1;let e=this.getFramePainter();return!(!e||this.xmin===this.xmax&&this.ymin===this.ymax||(e.zoom(this.xmin,this.xmax,this.ymin,this.ymax),0))}findFunc(){var e;let t=this.getObject();if(null==(e=null==t?void 0:t.fFunctions)?void 0:e.arr)for(let s=0;s<t.fFunctions.arr.length;++s){let r=t.fFunctions.arr[s];if("TF1"==r._typename||"TF2"==r._typename)return r}return null}findStat(){var e;let t=this.getObject();if(null==(e=null==t?void 0:t.fFunctions)?void 0:e.arr)for(let s=0;s<t.fFunctions.arr.length;++s){let r=t.fFunctions.arr[s];if("TPaveStats"==r._typename&&"stats"==r.fName)return r}return null}createStat(){var r;let t=this.findFunc();if(!t)return null;let e=this.findStat();if(e)return e;if((null==(r=this.getCanvPainter())?void 0:r.normal_canvas)||this.options.PadStats)return null;this.create_stats=!0;const s=b.gStyle;return e=(0,b.create)("TPaveStats"),Object.assign(e,{fName:"stats",fOptStat:0,fOptFit:s.fOptFit||111,fBorderSize:1}),e.fX1NDC=s.fStatX-s.fStatW,e.fY1NDC=s.fStatY-s.fStatH,e.fX2NDC=s.fStatX,e.fY2NDC=s.fStatY,e.fFillColor=s.fStatColor,e.fFillStyle=s.fStatStyle,e.fTextAngle=0,e.fTextSize=s.fStatFontSize,e.fTextAlign=12,e.fTextColor=s.fStatTextColor,e.fTextFont=s.fStatFont,e.AddText(t.fName),this.getObject().fFunctions.Add(e),e}fillStatistic(t,e,s){let r=this.findFunc();return!!(r&&s&&this.create_stats)&&(t.clearPave(),t.fillFunctionStat(r,s),!0)}drawNextFunction(t){var h,g;let e=this.getObject();if(t>=((null==(g=null==(h=null==e?void 0:e.fFunctions)?void 0:h.arr)?void 0:g.length)||0))return Promise.resolve(this);let s=this.getPadPainter(),r=e.fFunctions.arr[t],l=e.fFunctions.opt[t];return r.$main_painter=this,s.drawObject(this.getDom(),r,l).then(()=>this.drawNextFunction(t+1))}drawAxisHisto(){let t=this.createHistogram();return Y.f.draw(this.getDom(),t,this.options.Axis)}static _drawGraph(t,e){t.decodeOptions(e,!0),t.createBins(),t.createStat(),!b.settings.DragGraphs&&!graph.TestBit(F)&&graph.InvertBit(F);let s=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(s=t.drawAxisHisto().then(r=>{r&&(t.axes_draw=!0,t._own_histogram||(t.$primary=!0),r.$secondary=!0)})),s.then(()=>(t.addToPadPrimitives(),t.drawGraph())).then(()=>t.drawNextFunction(0))}static draw(t,e,s){return P._drawGraph(new P(t,e),s)}}}}]);
//# sourceMappingURL=879.f7e5384c873dac7a.js.map