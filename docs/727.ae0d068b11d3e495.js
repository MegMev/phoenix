"use strict";var y=Math.pow;(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[727],{3727:(O,_,m)=>{m.r(_),m.d(_,{TSplinePainter:()=>g});var p=m(1773),u=m(5611),P=m(2454),X=m(7320);class g extends P.tK{updateObject(t,i){let e=this.getObject();return e._typename==t._typename&&(e!==t&&Object.assign(e,t),void 0!==i&&this.decodeOptions(i),!0)}eval(t,i){let e=i-t.fX;return"TSplinePoly3"==t._typename?t.fY+e*(t.fB+e*(t.fC+e*t.fD)):"TSplinePoly5"==t._typename?t.fY+e*(t.fB+e*(t.fC+e*(t.fD+e*(t.fE+e*t.fF)))):t.fY+e}findX(t){let i=this.getObject(),e=0,n=i.fNp-1;if(t<=i.fXmin)return 0;if(t>=i.fXmax)return n;if(i.fKstep)e=Math.round((t-i.fXmin)/i.fDelta),t<i.fPoly[e].fX?e=Math.max(e-1,0):e<n&&t>i.fPoly[e+1].fX&&++e;else for(;n-e>1;){let a=Math.round((e+n)/2);t>i.fPoly[a].fX?e=a:n=a}return e}createDummyHisto(){let t=0,i=1,e=0,n=1,a=this.getObject();(null==a?void 0:a.fPoly)&&(t=i=a.fPoly[0].fX,e=n=a.fPoly[0].fY,a.fPoly.forEach(f=>{t=Math.min(f.fX,t),i=Math.max(f.fX,i),e=Math.min(f.fY,e),n=Math.max(f.fY,n)}),n>0&&(n*=1+p.gStyle.fHistTopMargin),e<0&&(e*=1+p.gStyle.fHistTopMargin));let s=(0,p.create)("TH1I");return s.fName=a.fName+"_hist",s.fTitle=a.fTitle,s.fXaxis.fXmin=t,s.fXaxis.fXmax=i,s.fYaxis.fXmin=e,s.fYaxis.fXmax=n,s}processTooltipEvent(t){let s,f,i=!1,e=this.getObject(),n=this.getFramePainter(),a=null==n?void 0:n.getGrFuncs(this.options.second_x,this.options.second_y),r=null,h=0;if(null!==t&&e&&a?(s=a.revertAxis("x",t.x),h=this.findX(s),r=e.fPoly[h],f=this.eval(r,s),h<e.fN-1&&Math.abs(e.fPoly[h+1].fX-s)<Math.abs(s-r.fX)&&(r=e.fPoly[++h]),Math.abs(a.grx(r.fX)-t.x)<.5*this.knot_size?(s=r.fX,f=r.fY):(r=null,(s<e.fXmin||s>e.fXmax)&&(i=!0))):i=!0,i)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let o=this.draw_g.select(".tooltip_bin"),c=this.lineatt.width+3;o.empty()&&(o=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",c).style("fill","none").call(this.lineatt.func));let l={name:this.getObject().fName,title:this.getObject().fTitle,x:a.grx(s),y:a.gry(f),color1:this.lineatt.color,lines:[],exact:null!==r||Math.abs(a.gry(f)-t.y)<c};l.changed=o.property("current_xx")!==s,l.menu=l.exact,l.menu_dist=Math.sqrt(y(l.x-t.x,2)+y(l.y-t.y,2)),l.changed&&o.attr("cx",Math.round(l.x)).attr("cy",Math.round(l.y)).property("current_xx",s);let x=this.getObjectHint();return x.length>0&&l.lines.push(x),l.lines.push("x = "+a.axisAsText("x",s)),l.lines.push("y = "+a.axisAsText("y",f)),null!==r&&(l.lines.push("knot = "+h),l.lines.push("B = "+(0,u.Ee)(r.fB,p.gStyle.fStatFormat)),l.lines.push("C = "+(0,u.Ee)(r.fC,p.gStyle.fStatFormat)),l.lines.push("D = "+(0,u.Ee)(r.fD,p.gStyle.fStatFormat)),void 0!==r.fE&&void 0!==r.fF&&(l.lines.push("E = "+(0,u.Ee)(r.fE,p.gStyle.fStatFormat)),l.lines.push("F = "+(0,u.Ee)(r.fF,p.gStyle.fStatFormat)))),l}redraw(){let t=this.getObject(),i=this.getFramePainter(),e=null==i?void 0:i.getGrFuncs(this.options.second_x,this.options.second_y),n=i.getFrameWidth(),a=i.getFrameHeight();if(this.createG(!0),this.knot_size=5,this.createAttLine({attr:t}),this.options.Line||this.options.Curve){let s=Math.max(10,t.fNpx),f=Math.max(i.scale_xmin,t.fXmin),r=Math.min(i.scale_xmax,t.fXmax),h=this.findX(f),o=[];i.logx&&(f=Math.log(f),r=Math.log(r));for(let x=0;x<s;++x){let d=f+(r-f)/s*(x-1);for(i.logx&&(d=Math.exp(d));h<t.fNp-1&&d>t.fPoly[h+1].fX;)++h;let M=this.eval(t.fPoly[h],d);o.push({x:d,y:M,grx:e.grx(d),gry:e.gry(M)})}let c=a;void 0!==i.hmin&&i.hmin>=0&&(c=Math.round(e.gry(0)),(c>a||c<0)&&(c=a));let l=(0,u.Cq)("bezier",o,c,2);this.draw_g.append("svg:path").attr("class","line").attr("d",l.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){let s="";this.createAttMarker({attr:t}),this.markeratt.resetPos(),this.knot_size=this.markeratt.getFullSize();for(let f=0;f<t.fPoly.length;f++){let r=t.fPoly[f],h=e.grx(r.fX);if(h>-this.knot_size&&h<n+this.knot_size){let o=e.gry(r.fY);o>-this.knot_size&&o<a+this.knot_size&&(s+=this.markeratt.create(h,o))}}s&&this.draw_g.append("svg:path").attr("d",s).call(this.markeratt.func)}}canZoomInside(t){return!("x"!==t||!this.getObject())}decodeOptions(t){let i=new u.pc(t);this.options||(this.options={});let e=!!this.getMainPainter();Object.assign(this.options,{Same:i.check("SAME"),Line:i.check("L"),Curve:i.check("C"),Mark:i.check("P"),Hopt:"AXIS",second_x:!1,second_y:!1}),!this.options.Line&&!this.options.Curve&&!this.options.Mark&&(this.options.Curve=!0),i.check("X+")&&(this.options.Hopt+="X+",this.options.second_x=e),i.check("Y+")&&(this.options.Hopt+="Y+",this.options.second_y=e),this.storeDrawOpt(t)}static draw(t,i,e){let n=new g(t,i);n.decodeOptions(e);let a=Promise.resolve(),s=!n.getMainPainter();if(s||n.options.second_x||n.options.second_y){if(n.options.Same&&s)return console.warn("TSpline painter requires histogram to be drawn"),null;let f=n.createDummyHisto();a=X.TH1Painter.draw(t,f,n.options.Hopt)}return a.then(()=>(n.addToPadPrimitives(),n.redraw(),n))}}}}]);
//# sourceMappingURL=727.ae0d068b11d3e495.js.map