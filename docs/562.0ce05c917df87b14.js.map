{"version":3,"file":"562.0ce05c917df87b14.js","mappings":"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","names":["ObjectPainter","setGridsRange","xmin","xmax","ratio","this","getObject","x_handle","getPadPainter","findPainterFor","fLowerPad","getFramePainter","full_min","full_max","fGridlines","forEach","line","fX1","fX2","redraw","pp","top_p","fTopPad","disablePadDrawing","up_p","fUpperPad","up_main","getMainPainter","up_fp","low_p","low_main","low_fp","lbl_size","promise_up","Promise","resolve","_ratio_configured","options","Axis","getHisto","fYaxis","fLabelSize","Math","round","min","getPadWidth","getPadHeight","h","fXaxis","fTitle","fTitleSize","getRootPad","fTicky","redrawPad","then","o_zoom","zoom","_ratio_low_fp","_ratio_painter","ymin","ymax","zmin","zmax","o_sizeChanged","sizeChanged","fX1NDC","fX2NDC","forEachPainterInPad","objp","testEditable","currpad","arr","fGridlinePositions","length","gridy","found","fY1","fY2","abs","create","scale_xmin","scale_xmax","fLineStyle","push","undefined","selectCurrentPad","fName","drawTLine","getDom","all","_ratio_up_fp","dom","opt","painter","TRatioPlotPainter","ensureTCanvas"],"sourceRoot":"webpack:///","sources":["../node_modules/jsroot/modules/draw/TRatioPlotPainter.mjs"],"sourcesContent":["import { create } from '../core.mjs';\nimport { ObjectPainter } from '../base/ObjectPainter.mjs';\nimport { ensureTCanvas } from '../gpad/TCanvasPainter.mjs';\nimport { drawTLine } from './more.mjs';\n\n\n/**\n * @summary Painter class for TRatioPlot\n *\n * @private\n */\n\nclass TRatioPlotPainter extends ObjectPainter {\n\n   /** @summary Set grids range */\n   setGridsRange(xmin, xmax) {\n      let ratio = this.getObject();\n      if (xmin === xmax) {\n         let x_handle = this.getPadPainter()?.findPainterFor(ratio.fLowerPad, \"lower_pad\", \"TPad\")?.getFramePainter()?.x_handle;\n         if (!x_handle) return;\n         xmin = x_handle.full_min;\n         xmax = x_handle.full_max;\n      }\n\n      ratio.fGridlines.forEach(line => {\n         line.fX1 = xmin;\n         line.fX2 = xmax;\n      });\n   }\n\n   /** @summary Redraw TRatioPlot */\n   redraw() {\n      let ratio = this.getObject(),\n          pp = this.getPadPainter();\n\n      let top_p = pp.findPainterFor(ratio.fTopPad, \"top_pad\", \"TPad\");\n      if (top_p) top_p.disablePadDrawing();\n\n      let up_p = pp.findPainterFor(ratio.fUpperPad, \"upper_pad\", \"TPad\"),\n          up_main = up_p?.getMainPainter(),\n          up_fp = up_p?.getFramePainter(),\n          low_p = pp.findPainterFor(ratio.fLowerPad, \"lower_pad\", \"TPad\"),\n          low_main = low_p?.getMainPainter(),\n          low_fp = low_p?.getFramePainter(),\n          lbl_size = 20, promise_up = Promise.resolve(true);\n\n      if (up_p && up_main && up_fp && low_fp && !up_p._ratio_configured) {\n         up_p._ratio_configured = true;\n         up_main.options.Axis = 0; // draw both axes\n\n         lbl_size = up_main.getHisto().fYaxis.fLabelSize;\n         if (lbl_size < 1) lbl_size = Math.round(lbl_size*Math.min(up_p.getPadWidth(), up_p.getPadHeight()));\n\n         let h = up_main.getHisto();\n         h.fXaxis.fLabelSize = 0; // do not draw X axis labels\n         h.fXaxis.fTitle = \"\"; // do not draw X axis title\n         h.fYaxis.fLabelSize = lbl_size;\n         h.fYaxis.fTitleSize = lbl_size;\n\n         up_p.getRootPad().fTicky = 1;\n\n         promise_up = up_p.redrawPad().then(() => {\n            up_fp.o_zoom = up_fp.zoom;\n            up_fp._ratio_low_fp = low_fp;\n            up_fp._ratio_painter = this;\n\n            up_fp.zoom = function(xmin,xmax,ymin,ymax,zmin,zmax) {\n               this._ratio_painter.setGridsRange(xmin, xmax);\n               this._ratio_low_fp.o_zoom(xmin,xmax);\n               return this.o_zoom(xmin,xmax,ymin,ymax,zmin,zmax);\n            }\n\n            up_fp.o_sizeChanged = up_fp.sizeChanged;\n            up_fp.sizeChanged = function() {\n               this.o_sizeChanged();\n               this._ratio_low_fp.fX1NDC = this.fX1NDC;\n               this._ratio_low_fp.fX2NDC = this.fX2NDC;\n               this._ratio_low_fp.o_sizeChanged();\n            }\n            return true;\n         });\n      }\n\n      return promise_up.then(() => {\n\n         if (!low_p || !low_main || !low_fp || !up_fp || low_p._ratio_configured)\n            return this;\n\n         low_p._ratio_configured = true;\n         low_main.options.Axis = 0; // draw both axes\n         let h = low_main.getHisto();\n         h.fXaxis.fTitle = \"x\";\n         h.fXaxis.fLabelSize = lbl_size;\n         h.fXaxis.fTitleSize = lbl_size;\n         h.fYaxis.fLabelSize = lbl_size;\n         h.fYaxis.fTitleSize = lbl_size;\n         low_p.getRootPad().fTicky = 1;\n\n         low_p.forEachPainterInPad(objp => {\n            if (typeof objp?.testEditable == 'function')\n               objp.testEditable(false);\n         });\n\n         let arr = [], currpad;\n\n         if ((ratio.fGridlinePositions.length > 0) && (ratio.fGridlines.length < ratio.fGridlinePositions.length)) {\n            ratio.fGridlinePositions.forEach(gridy => {\n               let found = false;\n               ratio.fGridlines.forEach(line => {\n                  if ((line.fY1 == line.fY2) && (Math.abs(line.fY1 - gridy) < 1e-6)) found = true;\n               });\n               if (!found) {\n                  let line = create(\"TLine\");\n                  line.fX1 = up_fp.scale_xmin;\n                  line.fX2 = up_fp.scale_xmax;\n                  line.fY1 = line.fY2 = gridy;\n                  line.fLineStyle = 2;\n                  ratio.fGridlines.push(line);\n                  if (currpad === undefined)\n                     currpad = this.selectCurrentPad(ratio.fLowerPad.fName);\n                  arr.push(drawTLine(this.getDom(), line));\n               }\n            });\n         }\n\n         return Promise.all(arr).then(() => low_fp.zoom(up_fp.scale_xmin,  up_fp.scale_xmax)).then(() => {\n\n            low_fp.o_zoom = low_fp.zoom;\n            low_fp._ratio_up_fp = up_fp;\n            low_fp._ratio_painter = this;\n\n            low_fp.zoom = function(xmin,xmax,ymin,ymax,zmin,zmax) {\n               this._ratio_painter.setGridsRange(xmin, xmax);\n               this._ratio_up_fp.o_zoom(xmin,xmax);\n               return this.o_zoom(xmin,xmax,ymin,ymax,zmin,zmax);\n            }\n\n            low_fp.o_sizeChanged = low_fp.sizeChanged;\n            low_fp.sizeChanged = function() {\n               this.o_sizeChanged();\n               this._ratio_up_fp.fX1NDC = this.fX1NDC;\n               this._ratio_up_fp.fX2NDC = this.fX2NDC;\n               this._ratio_up_fp.o_sizeChanged();\n            }\n            return this;\n         });\n      });\n   }\n\n   /** @summary Draw TRatioPlot */\n   static draw(dom, ratio, opt) {\n      let painter = new TRatioPlotPainter(dom, ratio, opt);\n\n      return ensureTCanvas(painter, false).then(() => painter.redraw());\n   }\n\n} // class TRatioPlotPainter\n\nexport { TRatioPlotPainter }\n"]}