"use strict";var Q=Math.pow;(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[636],{4636:(vt,gt,F)=>{F.r(gt),F.d(gt,{RH3Painter:()=>q,drawHistDisplayItem:()=>Mt});var ft=F(1773),O=F(1515),dt=F(5611),bt=F(6717),wt=F(757),zt=F(8597),H=F(6772),At=F(2018),Bt=F(7),Ct=F(3641);class q extends zt.n{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;let i=this.getHisto();if(i){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=i.fContMin,this.gminposbin=i.fContMinPos>0?i.fContMinPos:null,this.gmaxbin=i.fContMax;else{this.gminbin=this.gmaxbin=i.getBinContent(1,1,1);for(let e=0;e<this.nbinsx;++e)for(let n=0;n<this.nbinsy;++n)for(let o=0;o<this.nbinsz;++o){let h=i.getBinContent(e+1,n+1,o+1);h<this.gminbin?this.gminbin=h:h>this.gmaxbin&&(this.gmaxbin=h)}}this.draw_content=this.gmaxbin>0}}countStat(){let M,v,T,S,j,K,X,Z,G,E,t=this.getHisto(),i=this.getAxis("x"),e=this.getAxis("y"),n=this.getAxis("z"),o=0,h=0,l=0,g=0,x=0,m=0,p=0,B=this.getSelectIndex("x","left"),c=this.getSelectIndex("x","right"),f=this.getSelectIndex("y","left"),d=this.getSelectIndex("y","right"),y=this.getSelectIndex("z","left"),C=this.getSelectIndex("z","right"),I=this.getFramePainter(),_={name:t.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};for(M=1;M<=this.nbinsx;++M)for(S=i.GetBinCoord(M-.5),j=M<=B+1?0:M>c+1?2:1,v=1;v<=this.nbinsy;++v)for(K=e.GetBinCoord(v-.5),X=v<=f+1?0:v>d+1?2:1,T=1;T<=this.nbinsz;++T)Z=n.GetBinCoord(T-.5),G=T<=y+1?0:T>C+1?2:1,E=t.getBinContent(M,v,T),_.entries+=E,1==j&&1==X&&1==G&&(o+=E,h+=S*E,l+=K*E,g+=Z*E,x+=Q(S,2)*E,m+=Q(K,2)*E,p+=Q(Z,2)*E);return t.fTsumw>0&&!I.isAxisZoomed("x")&&!I.isAxisZoomed("y")&&!I.isAxisZoomed("z")&&(o=t.fTsumw,h=t.fTsumwx,x=t.fTsumwx2,l=t.fTsumwy,m=t.fTsumwy2,g=t.fTsumwz,p=t.fTsumwz2),o>0&&(_.meanx=h/o,_.meany=l/o,_.meanz=g/o,_.rmsx=Math.sqrt(Math.abs(x/o-Q(_.meanx,2))),_.rmsy=Math.sqrt(Math.abs(m/o-Q(_.meany,2))),_.rmsz=Math.sqrt(Math.abs(p/o-Q(_.meanz,2)))),_.integral=o,t.fEntries>1&&(_.entries=t.fEntries),_}fillStatistic(t,i){let e=this.countStat(),n=i%10,o=Math.floor(i/10)%10,h=Math.floor(i/100)%10,l=Math.floor(i/1e3)%10,g=Math.floor(i/1e6)%10;return t.clearStat(),n>0&&t.addText(e.name),o>0&&t.addText("Entries = "+t.format(e.entries,"entries")),h>0&&(t.addText("Mean x = "+t.format(e.meanx)),t.addText("Mean y = "+t.format(e.meany)),t.addText("Mean z = "+t.format(e.meanz))),l>0&&(t.addText("Std Dev x = "+t.format(e.rmsx)),t.addText("Std Dev y = "+t.format(e.rmsy)),t.addText("Std Dev z = "+t.format(e.rmsz))),g>0&&t.addText("Integral = "+t.format(e.integral,"entries")),!0}getBinTooltips(t,i,e){let n=[],o=this.getHisto(),h=1,l=1,g=1;this.isDisplayItem()&&(h=o.stepx||1,l=o.stepy||1,g=o.stepz||1),n.push(this.getObjectHint()),n.push("x = "+this.getAxisBinTip("x",t,h)+"  xbin="+t),n.push("y = "+this.getAxisBinTip("y",i,l)+"  ybin="+i),n.push("z = "+this.getAxisBinTip("z",e,g)+"  zbin="+e);let x=o.getBinContent(t+1,i+1,e+1),m="entries = "+(h>1||l>1||g>1?"~":"");return x===Math.round(x)?n.push(m+x):n.push(m+(0,dt.Ee)(x,ft.gStyle.fStatFormat)),n}draw3DScatter(t){let c,f,d,y,i=this.getHisto(),e=this.getFramePainter(),n=t.i1,o=t.i2,h=t.stepi,l=t.j1,g=t.j2,x=t.stepj,m=t.k1,p=t.k2,B=t.stepk;if(o<=n||g<=l||p<=m)return Promise.resolve(!0);let C=this.gmaxbin>1e3?1e3/this.gmaxbin:1,I=0,_=0,M=Math.max(0,this.gminbin);for(c=n;c<o;c+=h)for(f=l;f<g;f+=x)for(d=m;d<p;d+=B)y=i.getBinContent(c+1,f+1,d+1),_+=y,!(y<=M)&&(I+=Math.round(y*C));if(I>(e.webgl?1e5:3e4))return Promise.resolve(!1);let v=new H.B_(I,e.webgl,e.size_x3d/200),T=new Int32Array(I),S=0,j=this.getAxis("x"),K=this.getAxis("y"),X=this.getAxis("z"),Z=new dt.q9(_);for(c=n;c<o;c+=h)for(f=l;f<g;f+=x)for(d=m;d<p;d+=B){if(y=i.getBinContent(c+1,f+1,d+1),y<=M)continue;let G=Math.round(y*C);for(let E=0;E<G;++E){let b=j.GetBinCoord(c+Z.random()),w=K.GetBinCoord(f+Z.random()),P=X.GetBinCoord(d+Z.random());T[S++]=i.getBin(c+1,f+1,d+1),v.addPoint(e.grx(b),e.gry(w),e.grz(P))}}return v.createPoints({color:this.v7EvalColor("fill_color","red")}).then(G=>(e.toplevel.add(G),G.bins=T,G.painter=this,G.tip_color=65280,G.tooltip=function(E){if(!Number.isInteger(E.index))return console.error(`intersect.index not provided, three.js version ${O.UZH}`),null;let b=Math.floor(E.index/this.nvertex);if(b<0||b>=this.bins.length)return null;let w=this.painter,P=w.getFramePainter(),u=w.get3DToolTip(this.bins[b]);return u.x1=P.grx(w.getAxis("x").GetBinLowEdge(u.ix)),u.x2=P.grx(w.getAxis("x").GetBinLowEdge(u.ix+h)),u.y1=P.gry(w.getAxis("y").GetBinLowEdge(u.iy)),u.y2=P.gry(w.getAxis("y").GetBinLowEdge(u.iy+x)),u.z1=P.grz(w.getAxis("z").GetBinLowEdge(u.iz)),u.z2=P.grz(w.getAxis("z").GetBinLowEdge(u.iz+B)),u.color=this.tip_color,u.opacity=.3,u},!0))}draw3DBins(t){let m,p,i=this.v7EvalColor("fill_color","red"),e=this.getFramePainter(),n=0,o=!1,h=!1,l=!1,g=1,x=!0,B=.5;if(this.options.Sphere){B=.4,o=!0,11===this.options.Sphere&&(l=!0);let a=e.webgl?new O.xo$(.5,16,12):new O.xo$(.5,8,6);a.applyMatrix4((new O.yGw).makeRotationX(Math.PI/2)),a.computeVertexNormals();let r=a.getIndex().array,k=a.getAttribute("position").array,A=a.getAttribute("normal").array;n=3*r.length,m=new Float32Array(n),p=new Float32Array(n);for(let s=0;s<r.length;++s){let z=3*r[s];m[3*s]=k[z],m[3*s+1]=k[z+1],m[3*s+2]=k[z+2],p[3*s]=A[z],p[3*s+1]=A[z+1],p[3*s+2]=A[z+2]}}else{let a=H.XZ.Indexes,r=H.XZ.Normals,k=H.XZ.Vertices;n=3*a.length,m=new Float32Array(n),p=new Float32Array(n);for(let A=0,s=-3;A<a.length;++A){let z=k[a[A]];m[3*A]=z.x-.5,m[3*A+1]=z.y-.5,m[3*A+2]=z.z-.5,A%6==0&&(s+=3),p[3*A]=r[s],p[3*A+1]=r[s+1],p[3*A+2]=r[s+2]}h=!0,11==this.options.Box?l=!0:12==this.options.Box?(l=!0,h=!1):this.options.Color&&(l=!0,g=.5,x=!1,h=!1,o=!0)}x&&(x=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);let c=this.getHisto(),f=t.i1,d=t.i2,y=t.stepi,C=t.j1,I=t.j2,_=t.stepj,M=t.k1,v=t.k2,T=t.stepk,S=null;if(l&&(S=e.getHistPalette(),this.createContour(e,S)),d<=f||I<=C||v<=M)return!0;let w,P,u,W,U,j=this.getAxis("x"),K=this.getAxis("y"),X=this.getAxis("z"),Z=(e.grx(j.GetBinCoord(d))-e.grx(j.GetBinCoord(f)))/(d-f)*y,G=(e.gry(K.GetBinCoord(I))-e.gry(K.GetBinCoord(C)))/(I-C)*_,E=(e.grz(X.GetBinCoord(v))-e.grz(X.GetBinCoord(M)))/(v-M)*T,b=0,N=[],$=0,J=[];for(w=f;w<d;w+=y)for(P=C;P<I;P+=_)for(u=M;u<v;u+=T){if(U=c.getBinContent(w+1,P+1,u+1),!this.options.Color&&(0===U||U<this.gminbin)||(W=x?Math.pow(Math.abs(U*x),.3333):1,W<.001)||(b++,!l))continue;let a=S.getContourIndex(U);a>=0?(void 0===N[a]&&(N[a]=0,J[a]=$++),N[a]+=1):console.error("not found color for",U)}l||(N.push(b),$=1,J=[0]);let mt,at,ut,lt,ct,ht,it=new Array($),tt=new Array($),nt=new Array($),st=new Array($),V=new Array($),rt=new Array($),ot=new Array($);for(let a=0;a<N.length;++a){if(!N[a])continue;b=N[a];let r=J[a];it[r]=0,V[r]=0,h&&(V[r]=b*n/3>65520?2:1),tt[r]=new Float32Array(b*n),nt[r]=new Float32Array(b*n),st[r]=new Int32Array(b),1===V[r]&&(rt[r]=new Uint16Array(b*H.XZ.MeshSegments.length)),2===V[r]&&(ot[r]=new Float32Array(b*H.XZ.Segments.length*3))}for(j=this.getAxis("x"),K=this.getAxis("y"),X=this.getAxis("z"),w=f;w<d;w+=y)for(mt=j.GetBinCenter(w+1),at=e.grx(mt),P=C;P<I;P+=_)for(ut=K.GetBinCenter(P+1),lt=e.gry(ut),u=M;u<v;u+=T){if(U=c.getBinContent(w+1,P+1,u+1),!this.options.Color&&(0===U||U<this.gminbin)||(W=x?Math.pow(Math.abs(U*x),.3333):1,W<.001))continue;let a=0;if(l){let s=S.getContourIndex(U);if(s<0)continue;a=J[s]}b=it[a],ct=X.GetBinCenter(u+1),ht=e.grz(ct),st[a][b]=c.getBin(w+1,P+1,u+1);let r=b*n,k=tt[a],A=nt[a];for(let s=0;s<n;s+=3,r+=3)k[r]=at+m[s]*Z*W,k[r+1]=lt+m[s+1]*G*W,k[r+2]=ht+m[s+2]*E*W,A[r]=p[s],A[r+1]=p[s+1],A[r+2]=p[s+2];if(1===V[a]){let s=H.XZ.MeshSegments;r=b*s.length;let z=Math.round(b*n/3),R=rt[a];for(let D=0;D<s.length;++D)R[r+D]=z+s[D]}if(2===V[a]){let s=H.XZ.Segments,z=ot[a];r=b*s.length*3;for(let R=0;R<s.length;++R,r+=3){let D=H.XZ.Vertices[s[R]];z[r]=at+(D.x-.5)*Z*W,z[r+1]=lt+(D.y-.5)*G*W,z[r+2]=ht+(D.z-.5)*E*W}}it[a]=b+1}for(let a=0;a<N.length;++a){if(!N[a])continue;let r=J[a],k=new O.u9r;k.setAttribute("position",new O.TlE(tt[r],3)),k.setAttribute("normal",new O.TlE(nt[r],3)),l&&(i=S.getColor(a));let A=o?new O.YBo({color:i,opacity:g,transparent:g<1,vertexColors:!1}):new O.vBJ({color:i,opacity:g,vertexColors:!1}),s=new O.Kj0(k,A);if(s.bins=st[r],s.bins_faces=n/9,s.painter=this,s.scalex=B*Z,s.scaley=B*G,s.scalez=B*E,s.tip_color=65280,s.use_scale=x,s.tooltip=function(z){if(!Number.isInteger(z.faceIndex))return console.error(`intersect.faceIndex not provided, three.js version ${O.UZH}`),null;let R=Math.floor(z.faceIndex/this.bins_faces);if(R<0||R>=this.bins.length)return null;let D=this.painter,xt=D.getFramePainter(),L=D.get3DToolTip(this.bins[R]),pt=xt.grx(D.getAxis("x").GetBinCoord(L.ix-.5)),_t=xt.gry(D.getAxis("y").GetBinCoord(L.iy-.5)),yt=xt.grz(D.getAxis("z").GetBinCoord(L.iz-.5)),Y=this.use_scale?Math.pow(Math.abs(L.value*this.use_scale),.3333):1;return L.x1=pt-this.scalex*Y,L.x2=pt+this.scalex*Y,L.y1=_t-this.scaley*Y,L.y2=_t+this.scaley*Y,L.z1=yt-this.scalez*Y,L.z2=yt+this.scalez*Y,L.color=this.tip_color,L},e.toplevel.add(s),V[r]>0){let z=this.v7EvalColor("line_color","lightblue"),R=new O.nls({color:z}),D=null;D=1===V[r]?(0,H.Qy)(tt[r],R,rt[r]):(0,H.Qy)(ot[r],R),e.toplevel.add(D)}}l&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;let t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then(e=>e||this.draw3DBins(t))}redraw(t){let i=this.getFramePainter();return"resize"==t?(i.resize3D()&&i.render3D(),this):((0,Ct.g_)(i),i.create3DScene(this.options.Render3D).then(()=>(i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,wt.C,{zoom:ft.settings.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t))).then(()=>this.draw3D()).then(()=>(i.render3D(),i.addKeysHandler(),this)))}fillToolbar(){let t=this.getPadPainter();!t||(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,i,e){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(e,.5)-n.FindBin(i,0)>1}autoZoom(){let l,g,x,t=this.getSelectIndex("x","left"),i=this.getSelectIndex("x","right"),e=this.getSelectIndex("y","left"),n=this.getSelectIndex("y","right"),o=this.getSelectIndex("z","left"),h=this.getSelectIndex("z","right"),m=this.getHisto();if(t===i||e===n||o===h)return;let p=m.getBinContent(t+1,e+1,o+1);for(l=t;l<i;++l)for(g=e;g<n;++g)for(x=o;x<h;++x)p=Math.min(p,m.getBinContent(l+1,g+1,x+1));if(p>0)return;let B=i,c=t,f=n,d=e,y=h,C=o;for(l=t;l<i;++l)for(g=e;g<n;++g)for(x=o;x<h;++x)m.getBinContent(l+1,g+1,x+1)>p&&(l<B&&(B=l),l>=c&&(c=l+1),g<f&&(f=g),g>=d&&(d=g+1),x<y&&(y=x),x>=C&&(C=x+1));let I,_,M,v,T,S,j=!1;return B===c-1&&B>t+1&&c<i-1&&(B--,c++),f===d-1&&f>e+1&&d<n-1&&(f--,d++),y===C-1&&y>o+1&&C<h-1&&(y--,C++),(B>t||c<i)&&B<c-1&&(I=this.getAxis("x").GetBinLowEdge(B+1),_=this.getAxis("x").GetBinLowEdge(c+1),j=!0),(f>e||d<n)&&f<d-1&&(M=this.getAxis("y").GetBinLowEdge(f+1),v=this.getAxis("y").GetBinLowEdge(d+1),j=!0),(y>o||C<h)&&y<C-1&&(T=this.getAxis("z").GetBinLowEdge(y+1),S=this.getAxis("z").GetBinLowEdge(C+1),j=!0),j?this.getFramePainter().zoom(I,_,M,v,T,S):void 0}fillHistContextMenu(t){let i=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",i,e=>{if("inspect"===e)return this.showInspector();this.decodeOptions(e),this.interactiveRedraw(!0,"drawopt")})}static draw(t,i){let e=new q(t,i);return e.mode3d=!0,(0,bt.ensureRCanvas)(e,"3d").then(()=>{e.setAsMainPainter(),e.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:-1111,maximum:-1111};let n=e.v7EvalAttr("kind",""),o=e.v7EvalAttr("sub",0),h=e.options;switch(n){case"box":h.Box=10+o;break;case"sphere":h.Sphere=10+o;break;case"col":h.Color=!0;break;case"scat":h.Scatter=!0;break;default:h.Box=10}return e.scanContent(),e.redraw()})}}function Mt(et,t,i){return t?1==t.fAxes.length?At.RH1Painter.draw(et,t,i):2==t.fAxes.length?Bt.RH2Painter.draw(et,t,i):3==t.fAxes.length?q.draw(et,t,i):null:null}}}]);
//# sourceMappingURL=636.dbd1da6000bfc095.js.map